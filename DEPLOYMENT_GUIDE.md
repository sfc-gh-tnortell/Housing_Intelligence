# Housing Intelligence Deployment Guide

Complete setup guide for the Snowflake Housing Intelligence system with both Cortex Analyst (structured data) and Cortex Search (document search) capabilities.

## üéØ System Overview

This system provides comprehensive housing market intelligence through:
- **Cortex Analyst**: Natural language queries on structured sales data
- **Cortex Search**: Semantic search across purchase agreement PDFs
- **Integrated Analytics**: Combined insights from both structured and unstructured data

## üìã Prerequisites

### Snowflake Requirements
- Snowflake account with Cortex features enabled
- `SYSADMIN` role or equivalent permissions
- Compute warehouse (recommend `LARGE` or higher for optimal performance)
- Access to Snowsight or SnowSQL for file uploads

### Data Coverage
- **Geography**: 5 states (TX, CA, FL, CO, AZ)
- **Time Period**: 2022-2023 (24 months)
- **Transactions**: 58 sales with complete documentation
- **Documents**: Purchase agreement PDFs for each sale

## üöÄ Step-by-Step Deployment

### Step 1: Database and Schema Setup (3 minutes)
```sql
-- Execute the database setup script
-- File: 01_database_setup.sql
```
**Creates:**
- `HOUSING_INTELLIGENCE` database
- `CORE` schema
- 4 core tables: `CUSTOMERS`, `HOUSE_CHARACTERISTICS`, `HOUSE_SALES`, `PURCHASE_AGREEMENTS`
- 2 stages: `PURCHASE_AGREEMENTS_STAGE`, `SEMANTIC_MODELS_STAGE`
- Performance indexes and constraints

### Step 2: Load Multi-State Customer Data (2 minutes)
```sql
-- Execute the customer and property data script
-- File: 02_sample_data_multi_state.sql
```
**Populates:**
- 35 customers across TX, CA, FL, CO, AZ
- 60 properties with diverse characteristics
- Geographic distribution reflecting real market conditions

### Step 3: Load Sales Transactions (2 minutes)
```sql
-- Execute the sales data script spanning 2022-2023
-- File: 03_house_sales_2022_2023.sql
```
**Adds:**
- 58 sales transactions across 2 full years
- Interest rate progression from 4% to 7%+ 
- Seasonal and geographic market variations
- Complete financing and agent details

### Step 4: Generate Purchase Agreement PDFs (5 minutes)
```python
# Install required packages
pip install reportlab snowflake-connector-python

# Generate PDF documents
python 04_purchase_agreements_generator.py
```
**Generates:**
- 58 realistic purchase agreement PDFs
- Based on Washington State real estate forms
- Customized with actual sale data
- SQL registration script

### Step 5: Upload Documents to Snowflake (3 minutes)
```sql
-- Upload PDFs to Snowflake stage
PUT file://purchase_agreements/* @PURCHASE_AGREEMENTS_STAGE;

-- Upload semantic model
PUT file://05_semantic_model.yaml @SEMANTIC_MODELS_STAGE;

-- Register purchase agreements
-- Execute: register_purchase_agreements.sql (generated by Python script)
```

### Step 6: Create Semantic Model and Views (2 minutes)
```sql
-- Execute the semantic view creation script
-- File: 06_semantic_view.sql
```
**Creates:**
- Comprehensive semantic view with 50+ derived dimensions
- 6 analytical views for common queries
- Cortex Analyst semantic view with YAML model

### Step 7: Setup Cortex Services (3 minutes)
```sql
-- Execute the Cortex setup script
-- File: 07_cortex_setup.sql
```
**Deploys:**
- Cortex Analyst for natural language SQL queries
- Cortex Search service for PDF document search
- Integrated helper functions
- Dashboard metrics view

## ‚úÖ Verification and Testing

### Database Verification
```sql
-- Check record counts
SELECT 'CUSTOMERS' AS TABLE_NAME, COUNT(*) AS RECORDS FROM CUSTOMERS
UNION ALL
SELECT 'HOUSE_CHARACTERISTICS', COUNT(*) FROM HOUSE_CHARACTERISTICS  
UNION ALL
SELECT 'HOUSE_SALES', COUNT(*) FROM HOUSE_SALES
UNION ALL
SELECT 'PURCHASE_AGREEMENTS', COUNT(*) FROM PURCHASE_AGREEMENTS;

-- Expected: 35, 60, 58, 58 respectively
```

### Semantic View Testing
```sql
-- Test enriched semantic view
SELECT 
    REGIONAL_MARKET,
    COUNT(*) AS SALES,
    AVG(SALE_PRICE) AS AVG_PRICE
FROM HOUSING_SALES_SEMANTIC_VIEW
GROUP BY REGIONAL_MARKET
ORDER BY AVG_PRICE DESC;
```

### Cortex Analyst Testing
```sql
-- Test natural language queries
SELECT CORTEX_ANALYST_QUERY(
    'HOUSING_ANALYST_VIEW',
    'What is the average sale price by state?'
);

SELECT CORTEX_ANALYST_QUERY(
    'HOUSING_ANALYST_VIEW',
    'How did home prices change from 2022 to 2023?'
);
```

### Cortex Search Testing
```sql
-- Test document search
SELECT * FROM TABLE(
    CORTEX_SEARCH(
        'PURCHASE_AGREEMENTS_SEARCH',
        'inspection contingency',
        5
    )
);

-- Test integrated search function
SELECT * FROM TABLE(SEARCH_PURCHASE_AGREEMENTS('FHA financing'));
```

## üó£Ô∏è Natural Language Query Examples

### Market Analysis Queries
- "What is the average sale price by state?"
- "How did home prices change from 2022 to 2023?"
- "Which regions have the highest price per square foot?"
- "Compare sales volume between California and Texas"
- "What percentage of sales are cash vs financed by state?"

### Customer Analysis Queries
- "How does customer income affect home purchase prices?"
- "Which age group buys the most expensive homes?"
- "Compare purchasing patterns between married and single customers"
- "What credit score range dominates luxury home purchases?"

### Property Analysis Queries
- "Which states have properties with the highest walk scores?"
- "How does property age affect sale price?"
- "What premium features correlate with higher prices?"
- "Compare price per square foot across different property types"

### Temporal and Market Queries
- "How did interest rate changes affect days on market?"
- "What are the seasonal trends in home sales?"
- "Which markets saw the biggest price increases in 2023?"
- "How do cash sales vary by region?"

## üìÑ Document Search Examples

### Contract Terms Search
- "inspection contingency" - Find properties with inspection clauses
- "FHA financing first time buyer" - Identify FHA loan transactions
- "appraisal escalation clause" - Locate competitive market transactions
- "cash purchase no financing" - Find all-cash deals

### Legal and Contingency Search
- "hurricane insurance" (Florida properties)
- "earthquake contingency" (California properties)  
- "ski area access" (Colorado mountain properties)
- "golf membership transfer" (Golf course communities)

## üîß Troubleshooting

### Common Issues

**Issue**: Cortex Analyst not found
**Solution**: Verify Snowflake account has Cortex features enabled

**Issue**: Permission denied errors
**Solution**: Ensure you have `SYSADMIN` role and proper Cortex permissions

**Issue**: PDF upload failures
**Solution**: Check stage permissions and file format settings

**Issue**: Semantic model errors
**Solution**: Verify YAML file syntax and table references

**Issue**: Search service not returning results
**Solution**: Refresh the search service: `ALTER CORTEX SEARCH SERVICE PURCHASE_AGREEMENTS_SEARCH REFRESH;`

### Performance Optimization

1. **Warehouse Sizing**: Use `LARGE` or `X-LARGE` warehouse for Cortex operations
2. **Query Optimization**: Use analytical views for frequently accessed aggregations
3. **Search Indexing**: Allow time for search service to fully index documents
4. **Result Caching**: Leverage Snowflake's result caching for repeated queries

## üìä Dashboard Integration

The system provides dashboard-ready views:

```sql
-- Key metrics for dashboards
SELECT * FROM DASHBOARD_METRICS;

-- Monthly trends
SELECT * FROM MONTHLY_SALES_TRENDS;

-- Regional performance
SELECT * FROM REGIONAL_MARKET_PERFORMANCE;

-- Customer segments
SELECT * FROM CUSTOMER_SEGMENT_ANALYSIS;
```

## üîê Security and Governance

### Access Control
```sql
-- Create roles for different user types
CREATE ROLE HOUSING_ANALYST_ROLE;
CREATE ROLE HOUSING_VIEWER_ROLE;

-- Grant appropriate permissions
GRANT SELECT ON ALL VIEWS IN SCHEMA HOUSING_INTELLIGENCE.CORE TO ROLE HOUSING_VIEWER_ROLE;
GRANT USAGE ON CORTEX ANALYST HOUSING_ANALYST_VIEW TO ROLE HOUSING_ANALYST_ROLE;
```

### Data Privacy
- Customer PII is included for demo purposes
- Implement row-level security for production deployments
- Consider data masking for sensitive fields

## üöÄ Next Steps and Extensions

### Additional Data Sources
1. **MLS Integration**: Connect to Multiple Listing Service data
2. **Market Indices**: Integrate with housing price indices
3. **Economic Data**: Add local economic indicators
4. **Demographics**: Include census and demographic data

### Advanced Analytics
1. **Predictive Modeling**: Add price prediction models
2. **Market Forecasting**: Implement trend analysis
3. **Customer Scoring**: Develop buyer propensity models
4. **Investment Analysis**: Add ROI and yield calculations

### Application Development
1. **Web Interface**: Build React/Angular front-end
2. **Mobile App**: Create mobile analytics application
3. **API Integration**: Develop REST APIs for external systems
4. **Automated Reporting**: Set up scheduled report generation

## üìû Support Resources

- **Snowflake Cortex Documentation**: https://docs.snowflake.com/en/user-guide/snowflake-cortex/
- **Cortex Analyst Guide**: https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-analyst
- **Cortex Search Guide**: https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-search/
- **Semantic Models**: https://docs.snowflake.com/en/user-guide/views-semantic/overview

## üéâ System Capabilities Summary

**Deployment Time**: ~20 minutes  
**Data Volume**: 35 customers, 60 properties, 58 sales, 58 documents  
**Geographic Coverage**: 5 states across diverse markets  
**Temporal Coverage**: 24 months (2022-2023)  
**Query Capabilities**: Natural language + document search  
**Integration**: Unified structured and unstructured data analysis

Your Housing Intelligence system is now ready for comprehensive real estate market analysis! üè†üìà